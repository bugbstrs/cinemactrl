<div class="p-4" *ngIf="movie">
    <div class="grid">
        <div class="col-12 md:col-4 lg:col-3">
            <img [src]="movie.imageUrl" [alt]="movie.name" class="w-full rounded-lg shadow-md" />
        </div>
        <div class="col-12 md:col-8 lg:col-9">
            <h1 class="m-0">{{ movie.name }}</h1>
            <div class="flex align-items-center gap-3 my-3">
                <p-tag [value]="movie.ageRating + '+'" severity="info"></p-tag>
                <span>{{ movie.duration }} minutes</span>
                <span>Released: {{ movie.releaseDate | date }}</span>
            </div>

            <div class="flex align-items-center gap-2 mb-4">
                <span class="text-xl font-medium">{{ ratings?.averageRating || 'Not rated' }}</span>
                <!-- [cancel]="false" -->
                <p-rating [ngModel]="ratings?.averageRating" [readonly]="true"></p-rating>
                <span class="text-500">({{ ratings?.totalRatings }} ratings)</span>
            </div>

            <p class="line-height-3">{{ movie.description }}</p>

            <div class="mt-4 flex gap-3">
                <p-button label="Book Tickets" icon="pi pi-ticket"></p-button>
                <p-button label="Rate Movie" icon="pi pi-star" styleClass="p-button-outlined"
                    (onClick)="openRatingDialog()" [disabled]="!isAuthenticated"></p-button>
            </div>
        </div>
    </div>
</div>

<p-dialog header="Rate this movie" [(visible)]="ratingDialogVisible" [modal]="true" [style]="{width: '30rem'}">
    <div class="flex flex-column align-items-center gap-4 pt-3">
        <h3>{{ movie?.name }}</h3>
        <!-- [cancel]="false" -->
        <p-rating [(ngModel)]="userRating"></p-rating>
        <div class="flex gap-2">
            <p-button label="Cancel" styleClass="p-button-text" (onClick)="ratingDialogVisible = false"></p-button>
            <p-button label="Submit" (onClick)="submitRating()"></p-button>
            <p-button *ngIf="ratings?.rated" label="Remove Rating" styleClass="p-button-danger"
                (onClick)="removeRating()"></p-button>
        </div>
    </div>
</p-dialog>

<p-toast></p-toast>
